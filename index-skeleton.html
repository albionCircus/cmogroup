<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CMO Group Todo App</title>
  <!-- Include Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <main class="container mt-5">
    <h1 class="text-center mb-4">Todo App</h1>
    <!-- Search Input -->
    <section class="row mb-3">
      <div class="col-md-6 offset-md-3">
        <input type="text" id="searchInput" aria-label="Enter a search term" class="form-control" placeholder="Search by title...">
      </div>
    </section>
    <!-- Any bonus points for a loading spinner? (: -->
    <div id="loading" class="text-center my-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    <!-- Todo Table -->
    <table id="dataTable" class="table table-striped table-hover d-none">
      <thead>
        <tr>
          <th class="sortable" data-key="id">ID <i class="sort-icon bi bi-arrow-down-up text-secondary"></i></th>
          <th class="sortable" data-key="title">Title <i class="sort-icon bi bi-arrow-down-up text-secondary"></i></th>
          <th class="sortable" data-key="completed">Completed <i class="sort-icon bi bi-arrow-down-up text-secondary"></i></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <!-- Include jQuery and Bootstrap JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(document).ready(function () {
      const $tbody = $('#dataTable tbody');
      let allTodos = [];
      let currentSort = { key: null, asc: true };

      // Fetch data
      $.ajax({
        url: 'https://jsonplaceholder.typicode.com/todos',
        method: 'GET',
        success: function (todos) {
          allTodos = todos;
          renderRows(todos);
          $('#loading').hide();
          $('#dataTable').removeClass('d-none');
        },
        error: function () {
          $('#loading').html('<p class="text-danger">Failed to fetch todo items.</p>');
        }
      });

      // Render rows
      function renderRows(todos) {
        $tbody.empty();
        todos.forEach(todo => {
          const completedBadge = todo.completed
            ? '<span class="badge bg-success">Yes</span>'
            : '<span class="badge bg-danger">No</span>';
          const row = `
            <tr>
              <td>${todo.id}</td>
              <td>${todo.title}</td>
              <td>${completedBadge}</td>
            </tr>
          `;
          $tbody.append(row);
        });
      }

      // Search filter
      $('#searchInput').on('keyup', function () {
        const searchText = $(this).val().toLowerCase();
        const filtered = allTodos.filter(todo =>
          todo.title.toLowerCase().includes(searchText)
        );
        renderRows(filtered);
      });

      // Sorting
      $('th.sortable').on('click', function () {
        const key = $(this).data('key');
        const asc = currentSort.key === key ? !currentSort.asc : true;
        currentSort = { key, asc };

        const sorted = [...allTodos].sort((a, b) => {
          let valA = a[key];
          let valB = b[key];

          if (key === 'title') {
            valA = valA.toLowerCase();
            valB = valB.toLowerCase();
          } else if (key === 'completed') {
            valA = a.completed ? 1 : 0;
            valB = b.completed ? 1 : 0;
          }

          if (valA < valB) return asc ? -1 : 1;
          if (valA > valB) return asc ? 1 : -1;
          return 0;
        });

        const searchText = $('#searchInput').val().toLowerCase();
        const filtered = sorted.filter(todo =>
          todo.title.toLowerCase().includes(searchText)
        );

        renderRows(filtered);

        // Update icon
        $('th .sort-icon')
        .removeClass('bi-caret-up-fill bi-caret-down-fill text-primary')
        .addClass('bi-arrow-down-up text-secondary');
        const icon = $(this).find('.sort-icon');
        icon.addClass(asc ? 'bi-caret-up-fill' : 'bi-caret-down-fill').addClass('text-primary');
      });
    });
  </script>
</body>
</html>